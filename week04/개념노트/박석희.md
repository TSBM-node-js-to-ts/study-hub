# ğŸ“˜ 6ì¥ 

ì•ì—ì„œ **Express ê¸°ë³¸ êµ¬ì¡°**ì™€ **ì£¼ìš” ë¯¸ë“¤ì›¨ì–´(morgan, static, body-parser, cookie, session, multer)** ë¥¼ ë´¤ë‹¤.  
ì´ì œ ë‚¨ì€ í•µì‹¬ 3ê°€ì§€:

1. ë¼ìš°í„° ë¶„ë¦¬ (`Router` ê°ì²´)
2. `req` / `res` ê°ì²´ì— ì¶”ê°€ëœ í¸ì˜ ë©”ì„œë“œ
3. í…œí”Œë¦¿ ì—”ì§„(Pug / Nunjucks) + ì—ëŸ¬ ì²˜ë¦¬ ë·°

---

## 3ï¸âƒ£ Router ê°ì²´ë¡œ ë¼ìš°íŒ… ë¶„ë¦¬í•˜ê¸°

### 3-1. ë¼ìš°í„°ë¥¼ ë¶„ë¦¬í•´ì•¼ í•˜ëŠ” ì´ìœ 
- `app.js` ì•ˆì— `app.get`, `app.post` ë“±ì„ ë‹¤ ë•Œë ¤ ë„£ìœ¼ë©´:
    - íŒŒì¼ ê¸¸ì´ í­ë°œ
    - ê¸°ëŠ¥ë³„ë¡œ ë¶„ë¦¬/ê´€ë¦¬í•˜ê¸° ì–´ë ¤ì›€
- ExpressëŠ” **â€œì„œë¸Œ ë¼ìš°í„°â€** ê°œë…ì„ ì œê³µ â†’ `express.Router()`

### 3-2. ê¸°ë³¸ ë¼ìš°í„° íŒŒì¼ êµ¬ì¡°

**routes/index.js**

```js
const express = require('express');

const router = express.Router();

// GET / ë¼ìš°í„°
router.get('/', (req, res) => {
res.send('Hello, Express');
});

module.exports = router;
```

**routes/user.js**

```js
const express = require('express');

const router = express.Router();

// GET /user ë¼ìš°í„°
router.get('/', (req, res) => {
res.send('Hello, User');
});

module.exports = router;
```

### 3-3. app.jsì— ë¼ìš°í„° ì—°ê²°

```js
const express = require('express');
const path = require('path');
const dotenv = require('dotenv');

dotenv.config();

const indexRouter = require('./routes');       // ./routes/index.js ìƒëµ ê°€ëŠ¥
const userRouter = require('./routes/user');

const app = express();
app.set('port', process.env.PORT || 3000);

// ê³µí†µ ë¯¸ë“¤ì›¨ì–´ë“¤ ...

app.use('/', indexRouter);   // "/" ë¡œ ì‹œì‘í•˜ëŠ” ì£¼ì†Œ â†’ indexRouter
app.use('/user', userRouter); // "/user" ë¡œ ì‹œì‘í•˜ëŠ” ì£¼ì†Œ â†’ userRouter

// 404 ì²˜ë¦¬
app.use((req, res, next) => {
res.status(404).send('Not Found');
});

// ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´
app.use((err, req, res, next) => {
console.error(err);
res.status(500).send(err.message);
});

app.listen(app.get('port'), () => {
console.log(app.get('port'), 'ë²ˆ í¬íŠ¸ì—ì„œ ëŒ€ê¸° ì¤‘');
});
```

**ì£¼ì†Œ í•©ì³ì§€ëŠ” ê·œì¹™**
- `app.use('/user', userRouter)` + `router.get('/')` â†’ **GET /user**
- `app.use('/', indexRouter)` + `router.get('/')` â†’ **GET /**

---

### 3-4. next('route') â€“ ê°™ì€ ì£¼ì†Œì˜ ë‹¤ìŒ ë¼ìš°í„°ë¡œ ê±´ë„ˆë›°ê¸°

```js
router.get('/', (req, res, next) => {
  next('route'); // ì•„ë˜ ë¯¸ë“¤ì›¨ì–´ ë¬´ì‹œí•˜ê³  "ë‹¤ìŒ ë¼ìš°í„°"ë¡œ ì í”„
}, (req, res, next) => {
  console.log('ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
  next();
}, (req, res, next) => {
  console.log('ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
  next();
});

router.get('/', (req, res) => {
console.log('ì‹¤í–‰ë©ë‹ˆë‹¤');
res.send('Hello, Express');
});
```

- ê°™ì€ ì£¼ì†Œ(`/`) ë¼ìš°í„°ê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ìˆ˜ ìˆë‹¤.
- `next('route')` â†’ **í˜„ì¬ ë¼ìš°í„° ì²´ì¸ ë‚˜ë¨¸ì§€ ë¯¸ë“¤ì›¨ì–´ ê±´ë„ˆë›°ê³ **,  
  ê°™ì€ ì£¼ì†Œì˜ **ë‹¤ìŒ ë¼ìš°í„° í•¸ë“¤ëŸ¬**ë¡œ ì´ë™.

---

### 3-5. ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜(`:id`) ì™€ ì¿¼ë¦¬

#### 1) ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜ (`:id`)

```js
router.get('/user/:id', (req, res) => {
  console.log(req.params, req.query);
  // ì˜ˆ: /user/123?limit=5
  // req.params => { id: '123' }
  // req.query  => { limit: '5' }
});
```

- `/user/:id` ëŠ” `/user/1`, `/user/123` ë“± **ê°€ë³€ ê²½ë¡œ**ë¥¼ ì²˜ë¦¬.
- `req.params.id` ë¡œ í•´ë‹¹ ê°’ ì ‘ê·¼.

âš  **ì£¼ì˜: ë§¤ê°œë³€ìˆ˜ ë¼ìš°íŠ¸ëŠ” ë’¤ì— ë‘”ë‹¤**

```js
router.get('/user/:id', (req, res) => {
  console.log('ì–˜ë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.');
});

router.get('/user/like', (req, res) => {
console.log('ì „í˜€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
});
```

- `/user/like` ìš”ì²­ë„ `/user/:id` ì— ë§¤ì¹­ë¨ â†’ ì•„ë˜ ë¼ìš°í„°ëŠ” ë„ë‹¬ X
- ì •ì  ê²½ë¡œ (`/user/like`) ë¥¼ **ìœ„ì—**, ë§¤ê°œë³€ìˆ˜ ê²½ë¡œ (`/user/:id`) ë¥¼ **ì•„ë˜ì—** ë‘”ë‹¤.

#### 2) ì¿¼ë¦¬ìŠ¤íŠ¸ë§ (`?limit=5&skip=10`)
- `/users/123?limit=5&skip=10` ì´ ì˜¤ë©´:

    - `req.params` â†’ `{ id: '123' }`
    - `req.query`  â†’ `{ limit: '5', skip: '10' }`

---

### 3-6. 404 ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´

```js
app.use((req, res, next) => {
  res.status(404).send('Not Found');
});
```

- ì–´ë–¤ ë¼ìš°í„°ì—ë„ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ ì´ ë¯¸ë“¤ì›¨ì–´ì— ë„ë‹¬.
- Express ê¸°ë³¸ 404 ë¬¸êµ¬(`Cannot GET /abc`) ëŒ€ì‹  ì»¤ìŠ¤í…€ ë©”ì‹œì§€/í˜ì´ì§€ ì‚¬ìš©.

---

### 3-7. route() ì²´ì´ë‹ìœ¼ë¡œ ì½”ë“œ ë¬¶ê¸°

#### ê¸°ì¡´ ë°©ì‹

```js
router.get('/abc', (req, res) => {
  res.send('GET /abc');
});

router.post('/abc', (req, res) => {
res.send('POST /abc');
});
```

#### route ì²´ì´ë‹ ë°©ì‹

```js
router.route('/abc')
  .get((req, res) => {
    res.send('GET /abc');
  })
  .post((req, res) => {
    res.send('POST /abc');
  });
```

- **ê°™ì€ URL** (`/abc`) ì— ëŒ€í•œ ë©”ì„œë“œë³„( GET/POST/PUT/DELETEâ€¦ ) í•¸ë“¤ëŸ¬ë¥¼  
  **í•œ ë©ì–´ë¦¬**ë¡œ ë¬¶ì–´ ê°€ë…ì„±â†‘

---

## 4ï¸âƒ£ req, res ê°ì²´ ì‚´í´ë³´ê¸°

Expressì˜ `req` / `res` ëŠ” **Node `http` ê°ì²´ + í¸ì˜ ê¸°ëŠ¥**.

- ê¸°ì¡´ `res.writeHead`, `res.end` ê°™ì€ ê²ƒë„ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥
- ì‹¤ë¬´ì—ì„œëŠ” ëŒ€ë¶€ë¶„ **Express ë©”ì„œë“œ** ìœ„ì£¼ë¡œ ì‚¬ìš© (`res.send`, `res.json` ë“±)

---

### 4-1. ìì£¼ ì“°ëŠ” `req` ì†ì„±/ë©”ì„œë“œ

- `req.app`
    - `app` ê°ì²´ì— ì ‘ê·¼
    - ì˜ˆ: `req.app.get('port')`

- `req.body`
    - `express.json()`, `express.urlencoded()`(body-parser) ê°€ ë§Œë“¤ì–´ ì¤Œ
    - ìš”ì²­ ë³¸ë¬¸(JSON, í¼ ë°ì´í„° ë“±)

- `req.cookies`
    - `cookie-parser` ê°€ ë§Œë“¤ì–´ ì¤Œ
    - í‰ë¬¸ ì¿ í‚¤

- `req.signedCookies`
    - ì„œëª…ëœ ì¿ í‚¤ë“¤

- `req.params`
    - ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜
    - ì˜ˆ: `/user/:id` â†’ `req.params.id`

- `req.query`
    - ì¿¼ë¦¬ìŠ¤íŠ¸ë§
    - `/users?limit=5` â†’ `req.query.limit`

- `req.ip`
    - ìš”ì²­ ë³´ë‚¸ ìª½ IP

- `req.get(í—¤ë”ì´ë¦„)`
    - í—¤ë” ì¡°íšŒ (ì˜ˆ: `req.get('User-Agent')`)

---

### 4-2. ìì£¼ ì“°ëŠ” `res` ì†ì„±/ë©”ì„œë“œ

- `res.app`
    - `req.app` ê³¼ ë™ì¼(ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì ‘ê·¼)

- `res.status(ì½”ë“œ)`
    - HTTP ìƒíƒœ ì½”ë“œ ì„¤ì •, ì²´ì´ë‹ ê°€ëŠ¥
    - ì˜ˆ: `res.status(201).send('created');`

- `res.send(ë°ì´í„°)`
    - ë¬¸ìì—´, ë²„í¼, ê°ì²´, ë°°ì—´ ë“± ìë™ ì²˜ë¦¬
    - ê°ì²´/ë°°ì—´ì´ë©´ ìë™ìœ¼ë¡œ JSONìœ¼ë¡œ ë³´ë‚´ê¸°ë„ í•¨

- `res.json(JSON)`
    - ëª…ì‹œì ìœ¼ë¡œ JSON ì‘ë‹µ

- `res.sendFile(ê²½ë¡œ)`
    - ì •ì  íŒŒì¼ ì§ì ‘ ì‘ë‹µ (ë‹¤ìš´ë¡œë“œ/í˜ì´ì§€ ë Œë”ë§)

- `res.cookie(í‚¤, ê°’, ì˜µì…˜)` / `res.clearCookie(í‚¤, ì˜µì…˜)`
    - ì¿ í‚¤ ì„¤ì •/ì œê±°

- `res.redirect(ì£¼ì†Œ)`
    - 302 ë¦¬ë‹¤ì´ë ‰íŠ¸ ê¸°ë³¸

- `res.render(ë·°, ë°ì´í„°)`
    - í…œí”Œë¦¿ ì—”ì§„ ë Œë”ë§ (Pug, Nunjucks ë“±)
    - `app.set('view engine', 'pug' or 'html')` ì™€ ì—°ë™

- `res.locals`
    - ê°™ì€ ìš”ì²­ ì•ˆì˜ **ë¯¸ë“¤ì›¨ì–´/ë¼ìš°í„° ê°„ ë°ì´í„° ê³µìœ **
    - í…œí”Œë¦¿ ì—”ì§„ì—ì„œë„ ì´ ê°ì²´ë¥¼ ì½ì–´ ì‚¬ìš©

#### ë©”ì„œë“œ ì²´ì´ë‹ ì˜ˆì‹œ

```js
res
  .status(201)
  .cookie('test', 'test')
  .redirect('/admin');
```

---

## 5ï¸âƒ£ í…œí”Œë¦¿ ì—”ì§„ ì‚¬ìš©í•˜ê¸°

### 5-1. í…œí”Œë¦¿ ì—”ì§„ì´ í•„ìš”í•œ ì´ìœ 
- HTMLë§Œìœ¼ë¡œëŠ” **ë°˜ë³µ/ì¡°ê±´/ë³€ìˆ˜ ì¹˜í™˜**ì´ ë¶ˆí¸
- í…œí”Œë¦¿ ì—”ì§„ì€:
    - ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ HTMLì„ **ë™ì ìœ¼ë¡œ** ë Œë”ë§
    - ë°˜ë³µë¬¸, ì¡°ê±´ë¬¸, include, ë ˆì´ì•„ì›ƒ(extends) ë“± ì§€ì›

ì´ ì¥ì—ì„œëŠ” ë‘ ê°€ì§€ë¥¼ ë‹¤ë£¬ë‹¤:

1. **Pug(êµ¬ Jade)** â€“ ë“¤ì—¬ì“°ê¸° ê¸°ë°˜, HTML ê°„ì†Œí™”
2. **Nunjucks** â€“ HTML ë¬¸ë²• ìœ ì§€ + í…œí”Œë¦¿ ë¬¸ë²• ì¶”ê°€ (ì´ ì±…ì—ì„œëŠ” ìµœì¢…ì ìœ¼ë¡œ Nunjucks ì‚¬ìš©)

> ì‹¤ì œ ìµœì‹  íŠ¸ë Œë“œëŠ” React/Vue ê°™ì€ í”„ë¡ íŠ¸ì—”ë“œ í”„ë ˆì„ì›Œí¬ë¥¼ ë§ì´ ì“°ì§€ë§Œ,  
> ì„œë²„ í…œí”Œë¦¿ ì—”ì§„ ê°œë…ì€ ì—¬ì „íˆ ìœ íš¨í•˜ê³ , ì„œë²„ ë Œë”ë§ì—ë„ ê¸°ë³¸ì´ ëœë‹¤.

---

## 5-2. Pug(í¼ê·¸) â€“ ë¬¸ë²• ë§›ë³´ê¸°

### 5-2-1. Expressì™€ ì—°ê²°

ì„¤ì¹˜:

```bash
$ npm i pug
```

`app.js` ì„¤ì •:

```js
const path = require('path');
const express = require('express');

const app = express();
app.set('port', process.env.PORT || 3000);
app.set('views', path.join(__dirname, 'views')); // í…œí”Œë¦¿ í´ë”
app.set('view engine', 'pug');                   // í™•ì¥ì .pug
```

- `res.render('index')` â†’ `views/index.pug` ë Œë”ë§
- `res.render('admin/main')` â†’ `views/admin/main.pug`

---

### 5-2-2. ê¸°ë³¸ ë¬¸ë²• â€“ HTML í‘œí˜„

- **íƒœê·¸**: `<html>...</html>` â†’ `html` (ë“¤ì—¬ì“°ê¸°ë¡œ ë¶€ëª¨Â·ìì‹ í‘œí˜„)
- **ì†ì„±**: `tag(attr='value', attr2='val2')`
- **id / class**:
    - `#login-button` â†’ `<div id="login-button"></div>`
    - `.post-image` â†’ `<div class="post-image"></div>`

ì˜ˆì‹œ:

Pug:

```
doctype html
html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
  body
    h1 ìµìŠ¤í”„ë ˆìŠ¤
    p ë°°ì›Œë´…ì‹œë‹¤
```

HTML:

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Express</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
  </head>
  <body>
    <h1>ìµìŠ¤í”„ë ˆìŠ¤</h1>
    <p>ë°°ì›Œë´…ì‹œë‹¤</p>
  </body>
</html>
```

ì—¬ëŸ¬ ì¤„ í…ìŠ¤íŠ¸, `style.` / `script.` ë“±ë„ ì§€ì›(ë³¸ë¬¸ì²˜ëŸ¼).

---

### 5-2-3. ë³€ìˆ˜ ì‚¬ìš©

ë¼ìš°í„°ì—ì„œ:

```js
router.get('/', (req, res) => {
  res.render('index', { title: 'Express' });
});
```

Pugì—ì„œ:

```
h1= title
p Welcome to #{title}
button(class=title, type='submit') ì „ì†¡
input(placeholder=title + ' ì—°ìŠµ')
```

ë˜ëŠ” Pug ë‚´ë¶€ì—ì„œ ë³€ìˆ˜ ì„ ì–¸:

```
- const node = 'Node.js'
- const js = 'Javascript'
p #{node}ì™€ #{js}
```

ì´ìŠ¤ì¼€ì´í”„:

```
p= '<strong>ì´ìŠ¤ì¼€ì´í”„</strong>'
p!= '<strong>ì´ìŠ¤ì¼€ì´í”„í•˜ì§€ ì•ŠìŒ</strong>'
```

- `=` : HTML ì—”í‹°í‹°ë¡œ ì´ìŠ¤ì¼€ì´í”„
- `!=`: ì´ìŠ¤ì¼€ì´í”„ ì—†ì´ HTML ê·¸ëŒ€ë¡œ

---

### 5-2-4. ë°˜ë³µë¬¸ / ì¡°ê±´ë¬¸

ë°˜ë³µ:

```
ul
  each fruit, index in ['ì‚¬ê³¼', 'ë°°', 'ì˜¤ë Œì§€', 'ë°”ë‚˜ë‚˜', 'ë³µìˆ­ì•„']
    li= (index + 1) + 'ë²ˆì§¸ ' + fruit
```

ì¡°ê±´:

```
if isLoggedIn
  div ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
else
  div ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
```

`case` ë„ ì§€ì›:

```
case fruit
  when 'apple'
    p ì‚¬ê³¼ì…ë‹ˆë‹¤.
  when 'banana'
    p ë°”ë‚˜ë‚˜ì…ë‹ˆë‹¤.
  default
    p ì‚¬ê³¼ë„ ë°”ë‚˜ë‚˜ë„ ì˜¤ë Œì§€ë„ ì•„ë‹™ë‹ˆë‹¤.
```

---

### 5-2-5. include / extends & block

**include** â€“ ê³µí†µ ì¡°ê° ì‚½ì…:

```
/ header.pug
header
  a(href='/') Home
  a(href='/about') About

/ main.pug
include header
main
h1 ë©”ì¸ íŒŒì¼
p ë‹¤ë¥¸ íŒŒì¼ì„ includeí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```

**extends + block** â€“ ë ˆì´ì•„ì›ƒ:

`layout.pug`:

```
doctype html
html
  head
    title= title
    link(rel='stylesheet', href='/style.css')
  body
    block content
```

`index.pug`:

```
extends layout

block content
h1= title
p Welcome to #{title}
```

`error.pug`:

```
extends layout

block content
h1= message
h2= error.status
pre #{error.stack}
```

---

## 5-3. Nunjucks â€“ HTML ì¹œí™” í…œí”Œë¦¿ ì—”ì§„

Pug ë¬¸ë²•ì´ ë‚¯ì„¤ë‹¤ë©´, **Nunjucks**ëŠ” ê¸°ì¡´ HTMLì— **ë¬¸ë²•ì„ ì–¹ëŠ” ë°©ì‹**ì´ë¼ ì ì‘ì´ ì‰½ë‹¤.

### 5-3-1. Expressì™€ ì—°ê²°

ì„¤ì¹˜:

```bash
$ npm i nunjucks
```

ì„¤ì •:

```js
const express = require('express');
const path = require('path');
const nunjucks = require('nunjucks');
const dotenv = require('dotenv');

dotenv.config();

const app = express();
app.set('port', process.env.PORT || 3000);
app.set('view engine', 'html'); // .html íŒŒì¼ ì‚¬ìš©

nunjucks.configure('views', {
express: app,
watch: true, // í…œí”Œë¦¿ ë³€ê²½ ì‹œ ìë™ ë°˜ì˜
});
```

- ê¸°ë³¸ í™•ì¥ìëŠ” `.html` ì„ ì‚¬ìš©í•´ë„ ë˜ê³ ,  
  `.njk` ë¥¼ ì“°ê³  ì‹¶ë‹¤ë©´ `view engine` ë„ `njk` ë¡œ ë³€ê²½.

---

### 5-3-2. ë³€ìˆ˜

ë¼ìš°í„°:

```js
router.get('/', (req, res) => {
  res.render('index', { title: 'Express' });
});
```

Nunjucks:

```
<h1>{{title}}</h1>
<p>Welcome to {{title}}</p>
<button class="{{title}}" type="submit">ì „ì†¡</button>
<input placeholder="{{title}} ì—°ìŠµ" />
```

ë‚´ë¶€ ë³€ìˆ˜ ì„ ì–¸:

```
{% set node = 'Node.js' %}
{% set js = 'Javascript' %}
<p>{{node}}ì™€ {{js}}</p>
```

ì´ìŠ¤ì¼€ì´í”„ ì œì–´:

```
<p>{{'<strong>ì´ìŠ¤ì¼€ì´í”„</strong>'}}</p>
<p>{{'<strong>ì´ìŠ¤ì¼€ì´í”„í•˜ì§€ ì•ŠìŒ</strong>' | safe }}</p>
```

---

### 5-3-3. ë°˜ë³µë¬¸

```
<ul>
  {% set fruits = ['ì‚¬ê³¼', 'ë°°', 'ì˜¤ë Œì§€', 'ë°”ë‚˜ë‚˜', 'ë³µìˆ­ì•„'] %}
  {% for item in fruits %}
  <li>{{item}}</li>
  {% endfor %}
</ul>
```

ì¸ë±ìŠ¤ ì‚¬ìš©:

```
<ul>
  {% set fruits = ['ì‚¬ê³¼', 'ë°°', 'ì˜¤ë Œì§€', 'ë°”ë‚˜ë‚˜', 'ë³µìˆ­ì•„'] %}
  {% for item in fruits %}
  <li>{{loop.index}}ë²ˆì§¸ {{item}}</li>
  {% endfor %}
</ul>
```

---

### 5-3-4. ì¡°ê±´ë¬¸

ë¸”ë¡ ì¡°ê±´:

```
{% if isLoggedIn %}
<div>ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
{% else %}
<div>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
{% endif %}
```

`elif`:

```
{% if fruit === 'apple' %}
<p>ì‚¬ê³¼ì…ë‹ˆë‹¤.</p>
{% elif fruit === 'banana' %}
<p>ë°”ë‚˜ë‚˜ì…ë‹ˆë‹¤.</p>
{% elif fruit === 'orange' %}
<p>ì˜¤ë Œì§€ì…ë‹ˆë‹¤.</p>
{% else %}
<p>ì‚¬ê³¼ë„ ë°”ë‚˜ë‚˜ë„ ì˜¤ë Œì§€ë„ ì•„ë‹™ë‹ˆë‹¤.</p>
{% endif %}
```

ì¸ë¼ì¸ ì¡°ê±´:

```
<div>{{'ì°¸' if isLoggedIn}}</div>
<div>{{'ì°¸' if isLoggedIn else 'ê±°ì§“'}}</div>
```

---

### 5-3-5. include / extends & block

**include**:

`header.html`:

```
<header>
  <a href="/">Home</a>
  <a href="/about">About</a>
</header>
```

`footer.html`:

```
<footer>
  <div>í‘¸í„°ì…ë‹ˆë‹¤.</div>
</footer>
```

`main.html`:

```
{% include "header.html" %}
<main>
  <h1>ë©”ì¸ íŒŒì¼</h1>
  <p>ë‹¤ë¥¸ íŒŒì¼ì„ includeí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</main>
{% include "footer.html" %}
```

**ë ˆì´ì•„ì›ƒ**:

`layout.html`:

```
<!DOCTYPE html>
<html>
  <head>
    <title>{{title}}</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    {% block content %}
    {% endblock %}
  </body>
</html>
```

`index.html`:

```
{% extends 'layout.html' %}

{% block content %}
<h1>{{title}}</h1>
<p>Welcome to {{title}}</p>
{% endblock %}
```

`error.html`:

```
{% extends 'layout.html' %}

{% block content %}
<h1>{{message}}</h1>
<h2>{{error.status}}</h2>
<pre>{{error.stack}}</pre>
{% endblock %}
```

ë¼ìš°í„°ì—ì„œ `res.render('index')` í˜¸ì¶œ ì‹œ:
- `layout.html` ì˜ `{% block content %}` ìë¦¬ì—  
  `index.html` ì˜ `{% block content %}` ë‚´ìš©ì´ ë“¤ì–´ê°€ ìµœì¢… HTML ìƒì„±.

---

## 5-4. ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ì™€ í…œí”Œë¦¿ ì—°ë™

ë§ˆì§€ë§‰ìœ¼ë¡œ, 404/500 ì—ëŸ¬ë¥¼ **í…œí”Œë¦¿ìœ¼ë¡œ ì˜ˆì˜ê²Œ ì²˜ë¦¬**í•˜ëŠ” íŒ¨í„´.

`app.js` í•˜ë‹¨ì— ì¶”ê°€:

```js
// 404 ì²˜ë¦¬: ì¼ì¹˜í•˜ëŠ” ë¼ìš°í„° ì—†ìŒ
app.use((req, res, next) => {
  const error = new Error(`${req.method} ${req.url} ë¼ìš°í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
  error.status = 404;
  next(error); // ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ë¡œ ì „ë‹¬
});

// ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´
app.use((err, req, res, next) => {
res.locals.message = err.message;
res.locals.error =
process.env.NODE_ENV !== 'production' ? err : {}; // ë°°í¬ ì‹œ stack ìˆ¨ê¹€

res.status(err.status || 500);
res.render('error'); // views/error.html (ë˜ëŠ” .pug)
});
```

- `next(error)` â†’ ë°”ë¡œ **ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´**ë¡œ ì í”„
- `res.locals` ì— ë‹´ì€ ê°’ì€ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš© ê°€ëŠ¥
- ê°œë°œ í™˜ê²½: `error.stack` ê¹Œì§€ ë³´ì—¬ì£¼ê³ ,  
  ë°°í¬ í™˜ê²½(`NODE_ENV=production`): ë¯¼ê°í•œ ìŠ¤íƒ ì •ë³´ëŠ” ìˆ¨ê¹€

ë¸Œë¼ìš°ì €ì—ì„œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì†Œ ì ‘ì† ì‹œ:
- ì˜ˆ: `GET /abc ë¼ìš°í„°ê°€ ì—†ìŠµë‹ˆë‹¤.` ë©”ì‹œì§€ + ìƒíƒœ ì½”ë“œ(404 / 500) + (ê°œë°œ ëª¨ë“œë¼ë©´) ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ í™•ì¸ ê°€ëŠ¥.

---

## âœ… ì´ ì¥ì—ì„œ ê°€ì ¸ê°€ì•¼ í•  ê²ƒ

- **Router** ë¡œ ë¼ìš°íŒ…ì„ íŒŒì¼ë³„/ë„ë©”ì¸ë³„ë¡œ ë¶„ë¦¬ â†’ ìœ ì§€ë³´ìˆ˜ í¸í•´ì§
- `req` / `res` ì— ì˜¬ë¼ì˜¨ ë‹¤ì–‘í•œ ë„ìš°ë¯¸ë“¤ (`req.body`, `req.params`, `res.json`, `res.render`, `res.locals` â€¦)
- í…œí”Œë¦¿ ì—”ì§„(Pug / Nunjucks)ì„ í†µí•´:
    - ì„œë²„ ë°ì´í„° â†’ HTMLì— ìì—°ìŠ¤ëŸ½ê²Œ ë°”ì¸ë”©
    - ë°˜ë³µ/ì¡°ê±´/ë ˆì´ì•„ì›ƒ/ê³µí†µì˜ì—­(include) ì²˜ë¦¬
- ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ + í…œí”Œë¦¿ì„ í•©ì³ **404/500 í˜ì´ì§€** ê¹Œì§€ ê¹”ë”í•˜ê²Œ êµ¬ì„±

ì—¬ê¸°ê¹Œì§€ê°€ â€œExpress ê¸°ë³¸ê¸° ì„¸íŠ¸â€ë‹¤.  
ì´ì œ ì´ê±¸ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œ ì„œë¹„ìŠ¤ ìª½ ë¡œì§(ë¡œê·¸ì¸, ê²Œì‹œíŒ, íŒŒì¼ ì—…ë¡œë“œ, DB ì—°ë™ ë“±)ì„ ìŒ“ì•„ ì˜¬ë¦¬ê²Œ ëœë‹¤.
