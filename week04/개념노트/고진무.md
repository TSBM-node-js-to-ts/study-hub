# Node.js Express

## 1. 라우팅: 주소 체계 구성

Express의 `Router` 객체를 활용하여, 라우팅 관련 로직을 기능별 파일로 모듈화하여 체계적으로 관리할 수 있습니다.

- **라우터 연결:** 메인 애플리케이션 파일(예: `app.js`)에서 `app.use()` 메서드를 사용하여 특정 URL 접두사(prefix)로 들어오는 요청을 지정된 라우터 모듈로 전달하도록 설정합니다. (예: `app.use('/user', userRouter)`)
    
- **주요 데이터 접근:**
    - **`req.params`:** 라우트 매개변수. 주소 경로에 `:id`와 같은 변수를 정의하여, `/user/123` 형태의 요청이 발생했을 때 `req.params.id`를 통해 "123" 값을 추출할 수 있습니다.
    - **`req.query`:** 쿼리스트링. 주소의 `?` 이후에 `key=value` 형태로 전달되는 값을 `req.query` 객체를 통해 접근합니다. (예: `/search?q=node` 요청 시 `req.query.q`는 "node" 값을 가집니다.)
        
- **404 처리 미들웨어:** 정의된 라우터 중 어느 것과도 일치하지 않는 요청을 처리하기 위해, 라우터 설정 최하단에 404 상태 코드를 응답하는 미들웨어를 배치해야 합니다.

## 2. req 및 res 객체 활용

Express는 Node.js의 기본 `http` 객체를 확장하여, 요청 및 응답을 용이하게 처리할 수 있는 다양한 속성과 메서드를 제공합니다.

### 2.1. `req` (요청) 객체: 클라이언트로부터 수신된 정보

- `req.params`: 라우트 매개변수를 담고 있는 객체입니다.
- `req.query`: 쿼리스트링 파라미터를 담고 있는 객체입니다.
- `req.body`: `body-parser`와 같은 미들웨어에 의해 파싱된 요청 본문(payload) 데이터입니다.
    
### 2.2. `res` (응답) 객체: 서버에서 전송하는 응답

- `res.send(데이터)`: 문자열, HTML, JSON(객체) 등 다양한 형태의 응답을 전송합니다.
- `res.json(JSON)`: JSON 형식의 응답을 명시적으로 전송하며, 주로 API 응답에 사용됩니다.
- `res.render(뷰, 데이터)`: 템플릿 엔진을 사용하여 지정된 뷰 파일(예: `.pug`, `.njk`)을 렌더링한 후 HTML로 응답합니다.
- `res.status(코드)`: HTTP 응답 상태 코드(예: 200, 404, 500)를 설정합니다.
- `res.locals`: 하나의 요청/응답 사이클 내에서 미들웨어 간 데이터를 공유하기 위해 사용되는 객체입니다. 여기에 저장된 값은 템플릿 렌더링 시 변수로 자동 전달됩니다.

## 3. 템플릿 엔진 (Pug & Nunjucks)

템플릿 엔진은 서버 측 데이터를 동적으로 HTML에 삽입하여, 정적 파일을 동적 콘텐츠로 렌더링하는 기능을 수행합니다.

- **공통 구조 관리:** `extends`(레이아웃 상속) 및 `block`(내용 재정의) 키워드를 통해, 헤더나 푸터 등 공통되는 페이지 구조를 효율적으로 관리하고 재사용할 수 있습니다.

### 3.1. Pug

- **특징:** 닫는 태그(`</>`) 없이, 들여쓰기를 통해 HTML의 계층 구조를 정의하는 간결한 문법을 사용합니다.
- **변수 사용:** `h1= title` 또는 문장 내 `#{variable}` 형식을 통해 변수 값을 출력합니다.
- **제어문:** `each item in list`, `if condition` 등 축약된 키워드를 사용하여 반복문과 조건문을 구현합니다.

### 3.2. Nunjucks

- **특징:** 표준 HTML 문법을 그대로 사용하므로 기존 웹 개발자에게 친숙합니다.
- **변수 사용:** 변수 출력 시 `{{ variable }}` 형식을 사용합니다.
- **제어문:** `{% for item in list %}` ... `{% endfor %}` 및 `{% if condition %}` ... `{% endif %}`와 같이 `{% %}` 블록 내에 제어 로직을 작성합니다.

## 4. 에러 처리 미들웨어

- **정의:** `(err, req, res, next)` 형태의 4개 인자를 받는 특수 시그니처를 가지며, `app.js`의 404 미들웨어 하단(즉, 모든 미들웨어의 최하단)에 정의합니다.
- **실행:** 다른 미들웨어나 라우터에서 `next(error)` 함수가 에러 객체와 함께 호출될 때 실행됩니다.
- **처리:** 일반적으로 `res.locals`에 에러 정보를 할당한 후, 사용자에게 보여줄 전용 에러 템플릿 페이지를 렌더링합니다.
- **보안 고려사항:** `process.env.NODE_ENV` 값이 'production'(배포 환경)일 경우, 서버 구조 노출 등 보안 취약점을 방지하기 위해 `error.stack`과 같은 상세한 스택 트레이스 정보는 클라이언트에 전송하지 않도록 처리해야 합니다.

