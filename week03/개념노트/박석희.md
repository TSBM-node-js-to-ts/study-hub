# ğŸ“˜ 5ì¥

npmì„ í†µí•´ ì „ ì„¸ê³„ ê°œë°œìë“¤ì´ ë§Œë“¤ì–´ ë‘” **íŒ¨í‚¤ì§€(ëª¨ë“ˆ)** ë¥¼ ê°€ì ¸ì™€ ì“°ê³ , ë‚˜ì˜ ì½”ë“œë¥¼ ë°°í¬í•  ìˆ˜ ìˆë‹¤.  
ì´ ì¥ì—ì„œëŠ” **npm ê¸°ë³¸ ì‚¬ìš©ë²• â†’ íŒ¨í‚¤ì§€/ë²„ì „ ê´€ë¦¬ â†’ ìì£¼ ì“°ëŠ” ëª…ë ¹ì–´ â†’ ì§ì ‘ ë°°í¬** ìˆœì„œë¡œ ì •ë¦¬í•œë‹¤.

---

## 1ï¸âƒ£ npmì´ë€?
- **npm (Node Package Manager)**: Node.jsì˜ ê³µì‹ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì´ì íŒ¨í‚¤ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬.
- ì „ ì„¸ê³„ ìˆ˜ë§ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒ¨í‚¤ì§€ë“¤ì´ **íŒ¨í‚¤ì§€(=ë…¸ë“œ ëª¨ë“ˆ)** í˜•íƒœë¡œ ë“±ë¡ë¨.
- í•„ìš”í•œ ê¸°ëŠ¥ì„ **ì„¤ì¹˜í•´ì„œ ê°€ì ¸ë‹¤ ì“°ê³ **, ë‚´ ì½”ë“œë¥¼ **ë°°í¬**í•  ìˆ˜ë„ ìˆìŒ.

> ëŒ€ì•ˆ: **yarn**, **pnpm** â€” ì‚¬ìš©ë²•ì€ ê±°ì˜ ë™ì¼. ì„±ëŠ¥/í¸ì˜ ì°¨ì´ë§Œ ìˆìŒ.

---

## 2ï¸âƒ£ package.jsonìœ¼ë¡œ íŒ¨í‚¤ì§€ ê´€ë¦¬í•˜ê¸°
í”„ë¡œì íŠ¸ëŠ” ë³´í†µ **package.json** íŒŒì¼ë¡œ ì‹œì‘í•œë‹¤. ì„¤ì¹˜í•œ íŒ¨í‚¤ì§€ì˜ **ì´ë¦„/ë²„ì „/ìŠ¤í¬ë¦½íŠ¸** ë“±ì´ ê¸°ë¡ë˜ì–´ **ê°™ì€ í™˜ê²½ì„ ì¬í˜„**í•  ìˆ˜ ìˆë‹¤.

### 2-1. ì´ˆê¸°í™”
```bash
$ npm init
# name, version, description, main, scripts, author, license ë“± ì…ë ¥
```

ìƒì„± ì˜ˆì‹œ:
```json
{
"name": "npmtest",
"version": "0.0.1",
"description": "hello package.json",
"main": "index.js",
"scripts": {
"test": "echo \"Error: no test specified\" && exit 1"
},
"author": "YourName",
"license": "ISC"
}
```

### 2-2. scripts ì‹¤í–‰
```bash
$ npm run test
# start/test ëŠ” run ìƒëµ ê°€ëŠ¥: npm start, npm test
```


### 2-3. íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
$ npm install express
```

- **dependencies**ì— ê¸°ë¡ë¨:
    ```
    "dependencies": {
      "express": "^4.17.3"
    }
    ```

> **ì£¼ì˜**: í”„ë¡œì íŠ¸ ì´ë¦„(name)ê³¼ ì„¤ì¹˜í•  íŒ¨í‚¤ì§€ ì´ë¦„ì´ **ê²¹ì¹˜ë©´ ì•ˆ ë¨**.

### 2-4. ê°œë°œìš© íŒ¨í‚¤ì§€
ì‹¤ì œ ë°°í¬ì—ëŠ” ì“°ì§€ ì•Šê³  **ê°œë°œ ì¤‘ì—ë§Œ** ì“°ëŠ” ë„êµ¬ëŠ” `--save-dev`:
```bash
$ npm install --save-dev nodemon

"devDependencies": {
"nodemon": "^2.0.16"
}
```


### 2-5. peerDependencies
ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ **íŠ¹ì • ë²„ì „ì˜ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ê°€ ì¡´ì¬í•œë‹¤ê³  ê°€ì •**í•  ë•Œ:
```
"peerDependencies": {
"jquery": "^3.0.0"
}
```
- ì¶©ëŒ ì‹œ `ERESOLVE` ì˜¤ë¥˜ â†’ **í•´ë‹¹ ë²„ì „ìœ¼ë¡œ ë§ì¶”ê¸°**(ê¶Œì¥), ë¶ˆê°€ ì‹œ `npm i --force` ë˜ëŠ” `--legacy-peer-deps` (ë¹„ê¶Œì¥).

### 2-6. node_modules / package-lock.json
- **node_modules**: ì‹¤ì œ ì„¤ì¹˜ íŒŒì¼ í´ë”(ì»¤ë°‹ X).
- **package-lock.json**: ëª¨ë“  **ì •í™•í•œ ë²„ì „/ì˜ì¡´ê´€ê³„** ê¸°ë¡(ì»¤ë°‹ O).  
  ë°°í¬ í™˜ê²½ì—ì„œëŠ” **`npm ci`** ë¡œ lockì— **ì •í™•íˆ ì¼ì¹˜**í•˜ê²Œ ì„¤ì¹˜.

### 2-7. ì „ì—­ ì„¤ì¹˜ vs npx
- ì „ì—­(Global) ì„¤ì¹˜: CLIë¡œ ì“°ëŠ” ë„êµ¬ë¥¼ ì‹œìŠ¤í…œì— ì„¤ì¹˜
  ```bash
    $ npm install --global rimraf   # -g
    $ rimraf node_modules
  ```
- **npx**: ì „ì—­ ì„¤ì¹˜ ì—†ì´ **ë¡œì»¬ ì˜ì¡´ì„±**ì„ ëª…ë ¹ì²˜ëŸ¼ ì‹¤í–‰
  ```bash
  $ npm install --save-dev rimraf
  $ npx rimraf node_modules
  ```

### 2-8. ë‚´ì¥ ëª¨ë“ˆ ì´ë¦„ ì¶©ëŒ?
- `fs`, `os` ê°™ì€ **ë‚´ì¥ ëª¨ë“ˆ ì´ë¦„ê³¼ ë™ì¼í•œ npm íŒ¨í‚¤ì§€**ê°€ ìˆì–´ë„, `require('fs')` ëŠ” **ë‚´ì¥ ëª¨ë“ˆ**ì´ ë¡œë“œë¨.
- ëª…ì‹œí•˜ë ¤ë©´ **ë…¸ë“œ í”„ë¡œí† ì½œ** ì‚¬ìš©:
  ```js
  require('node:fs')
  ```

### 2-9. ì—¬ëŸ¬ ê°œ í•œ ë²ˆì— ì„¤ì¹˜ / ì œê±°
```bash
$ npm install morgan cookie-parser express-session
$ npm rm fs
```

### 2-ğŸ”Ÿ ì·¨ì•½ì  ì ê²€
$ npm audit
$ npm audit fix        # ìë™ ìˆ˜ì •
$ npm audit fix --force

### 2-âš™ï¸ node_modules ìˆ˜ì • íŒ¨ì¹˜ ë°˜ì˜
**patch-package**ë¡œ node_modules ìˆ˜ì •ì‚¬í•­ì„ ìœ ì§€:
```
# package.json
"scripts": { "postinstall": "patch-package" }

# ì„¤ì¹˜ & íŒ¨ì¹˜ ìƒì„±
$ npm i patch-package
# (node_modules ë‚´ ìˆ˜ì • í›„)
$ npx patch-package <íŒ¨í‚¤ì§€ëª…>
```

---

## 3ï¸âƒ£ íŒ¨í‚¤ì§€ ë²„ì „ ì´í•´í•˜ê¸° (SemVer)
ë²„ì „ì€ ë³´í†µ **ë©”ì´ì €.ë§ˆì´ë„ˆ.íŒ¨ì¹˜**(ì˜ˆ: 2.4.1)

- **ë©”ì´ì €**: í•˜ìœ„ í˜¸í™˜ ê¹¨ì§(ì˜ˆ: 1.x â†’ 2.0.0)
- **ë§ˆì´ë„ˆ**: ê¸°ëŠ¥ ì¶”ê°€(í˜¸í™˜ ìœ ì§€)
- **íŒ¨ì¹˜**: ë²„ê·¸ ìˆ˜ì •(í˜¸í™˜ ìœ ì§€)

> í•œ ë²ˆ ë°°í¬ëœ ë²„ì „ì˜ **ë‚´ìš©ì€ ë°”ê¾¸ì§€ ì•ŠëŠ”ë‹¤**. ë³€ê²½ ì‹œì—” **ìˆ«ìë¥¼ ì˜¬ë ¤ ìƒˆ ë²„ì „** ë°°í¬.

### ë²„ì „ ë²”ìœ„ ê¸°í˜¸
- **^1.2.3**: ë§ˆì´ë„ˆ/íŒ¨ì¹˜ ì—…ë°ì´íŠ¸ í—ˆìš© â†’ **1.x.x** (2.0.0 ë¯¸ë§Œ)
- **~1.2.3**: íŒ¨ì¹˜ë§Œ í—ˆìš© â†’ **1.2.x**
- ë¹„êµ ì—°ì‚°ì: `>`, `<`, `>=`, `<=`, `=`
- **@latest**: ì•ˆì • ìµœì‹ 
- **@next**: ìµœì‹  í”„ë¦¬ë¦´ë¦¬ì¦ˆ(ì•ŒíŒŒ/ë² íƒ€/RC í¬í•¨)

---

## 4ï¸âƒ£ ê¸°íƒ€ ìœ ìš©í•œ npm ëª…ë ¹ì–´
- ì—…ë°ì´íŠ¸ í™•ì¸:
  ```bash
  $ npm outdated
  # Current / Wanted / Latest ë¹„êµ
  $ npm update
  $ npm update <pkg>
  ```

- ì œê±°:
  ```bash
  $ npm uninstall <pkg>    # npm rm <pkg>
  ```

- ê²€ìƒ‰/ì •ë³´:
  ```bash
  $ npm search express
  $ npm info express
  ```

- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/í™•ì¸:
  ```bash
  $ npm login
  $ npm whoami
  $ npm logout
  ```

- ë²„ì „ ì˜¬ë¦¬ê¸°:
  ```bash
  $ npm version 5.3.2
  $ npm version major | minor | patch
  ```

- íŠ¹ì • ë²„ì „ ê²½ê³ (Deprecated):
  ```bash
  $ npm deprecate <pkg> "<message>"
  ```

- ë°°í¬/ì‚­ì œ:
  ```bash
  $ npm publish
  $ npm unpublish <pkg> --force # 24ì‹œê°„ ì´ë‚´ë§Œ ê°€ëŠ¥
  ```
---

## 5ï¸âƒ£ íŒ¨í‚¤ì§€ ë°°í¬í•˜ê¸° (í•µì‹¬ íë¦„)
1) **npm ê³„ì •** ìƒì„± & ì´ë©”ì¼ ì¸ì¦ â†’ ì½˜ì†”ì—ì„œ `npm login` (OTP í¬í•¨)
2) **ì—”íŠ¸ë¦¬ íŒŒì¼**(package.jsonì˜ `main`) ì‘ì„±

ì˜ˆì‹œ:
```js
module.exports = () => {
return 'hello package';
};
```

3) **ë°°í¬**
   ```bash
   $ npm publish
   ```
# ì´ë¦„ì´ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë©´ ì—ëŸ¬ â†’ package.jsonì˜ "name" ë³€ê²½ í›„ ì¬ì‹œë„

4) **ë²„ì „ ì—… í›„ ì¬ë°°í¬**=
   ```bash
   $ npm version patch # v0.0.1 -> v0.0.2
   $ npm publish
   ```

5) **ì‚­ì œ(ì‹¤ìˆ˜ ë°©ì§€ ì œì•½)**
   ```bash
   $ npm unpublish <pkg> --force   # 24ì‹œê°„ ì´ë‚´ë§Œ ê°€ëŠ¥
   ```

> ì‹¤ë¬´ì—ì„œëŠ” ë¦´ë¦¬ì¦ˆ ìë™í™” ë„êµ¬(ì˜ˆ: **release-it**)ë„ ìì£¼ ì‚¬ìš©.

---

## ğŸ§© ì˜ë¬¸ì 
- npmê³¼ yarn/pnpmì˜ ì‹¤ì œ ì²´ê° ì„±ëŠ¥ ì°¨ì´ëŠ”?
---

# ğŸ“˜ 6ì¥

4ì¥ì—ì„œ ì§ì ‘ HTTP ì„œë²„ë¥¼ ë§Œë“¤ë©° â€œë¼ìš°íŒ… ë¶„ê¸°, ë³¸ë¬¸ íŒŒì‹±, ì¿ í‚¤/ì„¸ì…˜ ì²˜ë¦¬â€ ê°™ì€ ê³µí†µ ì‘ì—…ì´ **ë°˜ë³µ**ë˜ê³  **í™•ì¥ì„±**ë„ ë–¨ì–´ì§„ë‹¤ëŠ” ê±¸ ëŠê¼ˆë‹¤ë©´, ì´ë²ˆ ì¥ì˜ **Express(ìµìŠ¤í”„ë ˆìŠ¤)** ê°€ ë°”ë¡œ í•´ê²°ì‚¬ë‹¤.  
ExpressëŠ” Node.jsì˜ `http` ìœ„ì— ì˜¬ë¼ê°€ëŠ” **ì›¹ ì„œë²„ í”„ë ˆì„ì›Œí¬**ë¡œ, ìš”ì²­/ì‘ë‹µ ê°ì²´ë¥¼ í™•ì¥í•˜ê³ , **ë¯¸ë“¤ì›¨ì–´** ê¸°ë°˜ìœ¼ë¡œ ê¸°ëŠ¥ì„ ëª¨ë“ˆí™”í•´ **ì½”ë“œ ê°€ë…ì„±Â·ìœ ì§€ë³´ìˆ˜ì„±**ì„ í¬ê²Œ ë†’ì¸ë‹¤.

> ë‹¤ë¥¸ ëŒ€ì•ˆ(koa, hapi)ë„ ìˆì§€ë§Œ, ìƒíƒœê³„ ê·œëª¨Â·ì˜ˆì œê°€ ê°€ì¥ í’ë¶€í•œ ê±´ ì—¬ì „íˆ **Express**.

---

## 1ï¸âƒ£ Expressë¥¼ ì“°ëŠ” ì´ìœ  (í•œ ì¤„ ìš”ì•½)
- **ë¼ìš°íŒ…/ë¯¸ë“¤ì›¨ì–´/ì—ëŸ¬ ì²˜ë¦¬**ê°€ ì²´ê³„ì  â†’ `if...else` ë¶„ê¸° ì§€ì˜¥ íƒˆì¶œ
- ìš”ì²­/ì‘ë‹µ ê°ì²´ ê¸°ëŠ¥ í™•ì¥(`res.send`, `res.json`, `res.sendFile` ë“±)
- ìƒíƒœê³„ê°€ ì»¤ì„œ **ì¿ í‚¤/ì„¸ì…˜/ë¡œê·¸/ì—…ë¡œë“œ** ë“± ê²€ì¦ëœ ë¯¸ë“¤ì›¨ì–´ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
---

## 2ï¸âƒ£ í”„ë¡œì íŠ¸ ì‹œì‘í•˜ê¸°

### 2-1. í”„ë¡œì íŠ¸ ì´ˆê¸°í™” & ì˜ì¡´ì„±
`package.json`ì€ ê°€ì¥ ë¨¼ì € ë§Œë“ ë‹¤.
```json
{
  "name": "learn-express",
  "version": "0.0.1",
  "description": "ìµìŠ¤í”„ë ˆìŠ¤ë¥¼ ë°°ìš°ì",
  "main": "app.js",
  "scripts": {
    "start": "nodemon app"
  },
  "author": "YourName",
  "license": "MIT"
}
```

ì„¤ì¹˜:
```bash
$ npm i express
$ npm i -D nodemon
```

- `start` ìŠ¤í¬ë¦½íŠ¸ì—ì„œ **nodemon**ì„ ì‚¬ìš©í•˜ë©´ íŒŒì¼ ì €ì¥ ì‹œ ì„œë²„ **ìë™ ì¬ì‹œì‘**
- ë°°í¬ í™˜ê²½ì—ì„œëŠ” `nodemon` ì‚¬ìš© X (ê°œë°œìš© ì „ìš©)

### 2-2. ìµœì†Œ ì„œë²„(app.js)
```js
const express = require('express');

const app = express();
app.set('port', process.env.PORT || 3000);

app.get('/', (req, res) => {
res.send('Hello, Express');
});

app.listen(app.get('port'), () => {
console.log(app.get('port'), 'ë²ˆ í¬íŠ¸ì—ì„œ ëŒ€ê¸° ì¤‘');
});
```

ì‹¤í–‰:
```bash
$ npm start
```

### 2-3. HTML íŒŒì¼ ì‘ë‹µ
```html
<!-- index.html -->
<html>
<head>
  <meta charset="UTF-8" />
  <title>ìµìŠ¤í”„ë ˆìŠ¤ ì„œë²„</title>
</head>
<body>
  <h1>ìµìŠ¤í”„ë ˆìŠ¤</h1>
  <p>ë°°ì›Œë´…ì‹œë‹¤.</p>
</body>
</html>
```
```js
const express = require('express');
const path = require('path');

const app = express();
app.set('port', process.env.PORT || 3000);

app.get('/', (req, res) => {
res.sendFile(path.join(__dirname, 'index.html'));
});

app.listen(app.get('port'), () => {
console.log(app.get('port'), 'ë²ˆ í¬íŠ¸ì—ì„œ ëŒ€ê¸° ì¤‘');
});
```

---

## 3ï¸âƒ£ ë¯¸ë“¤ì›¨ì–´ í•µì‹¬ ê°œë…ê³¼ íë¦„

### 3-1. ë¯¸ë“¤ì›¨ì–´ ê¸°ë³¸
- **í˜•íƒœ**: `(req, res, next) => { ... }`
- **ì—°ê²°**: `app.use(...)`, `app.get(..., ë¯¸ë“¤ì›¨ì–´1, ë¯¸ë“¤ì›¨ì–´2, ...)`
- **íë¦„**: ìœ„â†’ì•„ë˜ **ìˆœì°¨ ì‹¤í–‰**, ë‹¤ìŒìœ¼ë¡œ ë„˜ê¸°ë ¤ë©´ `next()` í˜¸ì¶œ
- **íŠ¹ìˆ˜**: ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ëŠ” **ì¸ì 4ê°œ** `(err, req, res, next)`

ì˜ˆì‹œ:

```js
app.use((req, res, next) => {
  console.log('ëª¨ë“  ìš”ì²­ì—ì„œ ì‹¤í–‰');
  next();
});

app.get('/', (req, res, next) => {
console.log('GET / ì—ì„œë§Œ ì‹¤í–‰');
next();
}, (req, res) => {
throw new Error('ì—ëŸ¬ëŠ” ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ë¡œ ì´ë™');
});

app.use((err, req, res, next) => {
console.error(err);
res.status(500).send(err.message);
});
```

> `next('route')` â†’ ë‹¤ìŒ ë¼ìš°í„°ë¡œ ì í”„,  
> `next(err)` â†’ **ë°”ë¡œ ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´**ë¡œ ì´ë™

### 3-2. ì‹¤í–‰ ë²”ìœ„ ì œì–´
- `app.use(ë¯¸ë“¤ì›¨ì–´)` â†’ ëª¨ë“  ìš”ì²­
- `app.use('/abc', ë¯¸ë“¤ì›¨ì–´)` â†’ `/abc`ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ë§Œ
- `app.post('/abc', ë¯¸ë“¤ì›¨ì–´)` â†’ `/abc` **POST**ë§Œ

### 3-3. ë¯¸ë“¤ì›¨ì–´ ê°„ ë°ì´í„° ê³µìœ 
- ìš”ì²­ ìƒëª…ì£¼ê¸° ë™ì•ˆë§Œ ê³µìœ : **`res.locals`**
- ì•± ì „ì—­ ì„¤ì •(ìš”ì²­ê³¼ ë¬´ê´€): **`app.set` / `app.get`**

```js
app.use((req, res, next) => {
  res.locals.data = 'í•œ ìš”ì²­ ë‚´ì—ì„œë§Œ ê³µìœ ';
  next();
});
```

---

## 4ï¸âƒ£ ìì£¼ ì“°ëŠ” ë¯¸ë“¤ì›¨ì–´ ëª¨ìŒ

### 4-1. morgan (ìš”ì²­ ë¡œê¹…)
```js
const morgan = require('morgan');
app.use(morgan('dev'));  // dev | combined | common | short | tiny
```

- ì˜ˆ: `GET / 200 7.409 ms - 50`  
  â†’ [ë©”ì„œë“œ] [ê²½ë¡œ] [ìƒíƒœ] [ì†Œìš” ms] - [ì‘ë‹µ ë°”ì´íŠ¸]

### 4-2. static (ì •ì  íŒŒì¼ ì œê³µ)
```js
const path = require('path');
app.use('/', express.static(path.join(__dirname, 'public')));
```

- `public/styles.css` â†’ `http://localhost:3000/styles.css`
- ì‹¤ì œ ì„œë²„ ê²½ë¡œì™€ ìš”ì²­ ê²½ë¡œê°€ ë¶„ë¦¬ë˜ì–´ **ë³´ì•ˆ ì¸¡ë©´**ì—ì„œë„ ìœ ë¦¬
- íŒŒì¼ì´ ì¡´ì¬í•˜ë©´ **ì‘ë‹µ í›„ next ë¯¸í˜¸ì¶œ** (ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ ì‹¤í–‰ X)

### 4-3. body-parser (ë‚´ì¥ ë²„ì „)
ë³¸ë¬¸ ë°ì´í„°ë¥¼ **`req.body`** ë¡œ íŒŒì‹±:

```js
app.use(express.json()); // JSON
app.use(express.urlencoded({ extended: false })); // í¼ URL-encoded
```
> Raw/Text ë³¸ë¬¸ì´ í•„ìš”í•˜ë©´ ë³„ë„ ì„¤ì¹˜:
```js
// $ npm i body-parser
const bodyParser = require('body-parser');
app.use(bodyParser.raw());
app.use(bodyParser.text());
```

### 4-4. cookie-parser (ì¿ í‚¤ íŒŒì‹±)
```js
const cookieParser = require('cookie-parser');
app.use(cookieParser(process.env.COOKIE_SECRET));
```

- í‰ë¬¸ ì¿ í‚¤: `req.cookies`, ì„œëª… ì¿ í‚¤: `req.signedCookies`
- ì¿ í‚¤ ì„¤ì •/ì‚­ì œ:
  ```js
  res.cookie('name', 'zerocho', {
  httpOnly: true, secure: true,
  expires: new Date(Date.now() + 900000),
  });
  res.clearCookie('name', 'zerocho', { httpOnly: true, secure: true });
  ```

### 4-5. express-session (ì„¸ì…˜)
```js
const session = require('express-session');
app.use(session({
  resave: false,
  saveUninitialized: false,
  secret: process.env.COOKIE_SECRET,
  cookie: { httpOnly: true, secure: false },
  name: 'session-cookie',
}));
```

- `req.session`ì— ì‚¬ìš©ìë³„ ë°ì´í„° ì €ì¥:
  ```js
  req.session.name = 'zerocho';
  req.sessionID;          // ì„¸ì…˜ ID
  req.session.destroy();  // ì„¸ì…˜ ì œê±°
  ```

> ë°°í¬ ì‹œì—ëŠ” **store(ì˜ˆ: Redis)** ë¥¼ ì—°ê²°í•´ ì„¸ì…˜ì„ ì™¸ë¶€ì— ë³´ê´€(ì„œë²„ ì¬ì‹œì‘ ì‹œ ìœ ì§€)

### 4-6. .env í™˜ê²½ë³€ìˆ˜ (dotenv)
```js
const dotenv = require('dotenv');
dotenv.config();  // .env â†’ process.env
```
- ë¹„ë°€ í‚¤/í™˜ê²½ë³„ ì„¤ì •ì„ ì½”ë“œì—ì„œ ë¶„ë¦¬, **ë³´ì•ˆ/í¸ì˜ì„±** í–¥ìƒ

### 4-7. ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´: â€œë¯¸ë“¤ì›¨ì–´ ì•ˆì— ë¯¸ë“¤ì›¨ì–´â€
```js
app.use((req, res, next) => {
  if (process.env.NODE_ENV === 'production') {
    require('morgan')('combined')(req, res, next);
  } else {
    require('morgan')('dev')(req, res, next);
  }
});
```
- ì¡°ê±´ì— ë”°ë¼ **ë™ì ìœ¼ë¡œ ë‹¤ë¥¸ ë¯¸ë“¤ì›¨ì–´** ì£¼ì… ê°€ëŠ¥

---

## 5ï¸âƒ£ íŒŒì¼ ì—…ë¡œë“œ: multer

### 5-1. ì„¤ì¹˜ & ê¸°ë³¸ ì„¤ì •
```bash
$ npm i multer
```

ì—…ë¡œë“œ ë””ë ‰í„°ë¦¬ ì¤€ë¹„:

```js
const fs = require('fs');
try { fs.readdirSync('uploads'); }
catch (e) {
  console.error('uploads í´ë”ê°€ ì—†ì–´ ìƒì„±í•©ë‹ˆë‹¤.');
  fs.mkdirSync('uploads');
}
```

multer ì¸ìŠ¤í„´ìŠ¤:

```js
const multer = require('multer');
const path = require('path');

const upload = multer({
storage: multer.diskStorage({
destination(req, file, done) {
done(null, 'uploads/');                      // ì €ì¥ í´ë”
},
filename(req, file, done) {
const ext = path.extname(file.originalname); // .png
done(null, path.basename(file.originalname, ext) + Date.now() + ext);
},
}),
limits: { fileSize: 5 * 1024 * 1024 },          // 5MB
});
```

### 5-2. ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ (single)
í¼:

```html
<form action="/upload" method="post" enctype="multipart/form-data">
  <input type="file" name="image" />
  <input type="text" name="title" />
  <button type="submit">ì—…ë¡œë“œ</button>
</form>
```

ë¼ìš°í„°:

```js
app.post('/upload', upload.single('image'), (req, res) => {
  console.log(req.file);  // íŒŒì¼ ë©”íƒ€ë°ì´í„°
  console.log(req.body);  // í…ìŠ¤íŠ¸ í•„ë“œ
  res.send('ok');
});
```

`req.file` ì˜ˆì‹œ:
```
{
  fieldname: 'image',
  originalname: 'nodejs.png',
  encoding: '7bit',
  mimetype: 'image/png',
  destination: 'uploads/',
  filename: 'nodejs1693456789012.png',
  path: 'uploads/nodejs1693456789012.png',
  size: 53357
}
```
### 5-3. ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ
- ê°™ì€ name, ì—¬ëŸ¬ íŒŒì¼: **array**
  ```js
  <input type="file" name="many" multiple />
  app.post('/upload', upload.array('many'), (req, res) => {
  console.log(req.files); // ë°°ì—´
  res.send('ok');
  });
  ```

- ë‹¤ë¥¸ name ê°ê°: **fields**
  ```js
  <input type="file" name="image1" />
  <input type="file" name="image2" />
  app.post('/upload',
  upload.fields([{ name: 'image1' }, { name: 'image2' }]),
  (req, res) => {
  console.log(req.files.image1, req.files.image2);
  res.send('ok');
  }
  );
  ```

- íŒŒì¼ ì—†ì´ ë©€í‹°íŒŒíŠ¸ í¼: **none**
  ```js
    <form action="/upload" method="post" enctype="multipart/form-data">
      <input type="text" name="title" />
      <button type="submit">ì—…ë¡œë“œ</button>
    </form>
    
    app.post('/upload', upload.none(), (req, res) => {
    console.log(req.body);
    res.send('ok');
    });
  ```

---

## 6ï¸âƒ£ í•œ í™”ë©´ì— ëª¨ì•„ë³´ê¸° (ì‹¤ìŠµìš© ìŠ¤ë‹ˆí«)

`.env`:
```
COOKIE_SECRET=cookiesecret
```

`app.js` (í•µì‹¬ë§Œ ë°œì·Œ):
```js
const express = require('express');
const morgan = require('morgan');
const cookieParser = require('cookie-parser');
const session = require('express-session');
const dotenv = require('dotenv');
const path = require('path');
const fs = require('fs');
const multer = require('multer');

dotenv.config();
const app = express();
app.set('port', process.env.PORT || 3000);

app.use(morgan('dev'));
app.use('/', express.static(path.join(__dirname, 'public')));
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(cookieParser(process.env.COOKIE_SECRET));
app.use(session({
resave: false,
saveUninitialized: false,
secret: process.env.COOKIE_SECRET,
cookie: { httpOnly: true, secure: false },
name: 'session-cookie',
}));

try { fs.readdirSync('uploads'); }
catch (e) { fs.mkdirSync('uploads'); }

const upload = multer({
storage: multer.diskStorage({
destination(req, file, done) { done(null, 'uploads/'); },
filename(req, file, done) {
const ext = path.extname(file.originalname);
done(null, path.basename(file.originalname, ext) + Date.now() + ext);
},
}),
limits: { fileSize: 5 * 1024 * 1024 },
});

app.get('/upload', (req, res) => {
res.sendFile(path.join(__dirname, 'multipart.html'));
});
app.post('/upload', upload.single('image'), (req, res) => {
console.log(req.file);
res.send('ok');
});

app.get('/', (req, res) => {
res.send('Hello, Express');
});

app.use((err, req, res, next) => {
console.error(err);
res.status(500).send(err.message);
});

app.listen(app.get('port'), () => {
console.log(app.get('port'), 'ë²ˆ í¬íŠ¸ì—ì„œ ëŒ€ê¸° ì¤‘');
});
```

`multipart.html`:
```html
<form id="form" action="/upload" method="post" enctype="multipart/form-data">
  <input type="file" name="image" />
  <input type="text" name="title" />
  <button type="submit">ì—…ë¡œë“œ</button>
</form>
```
